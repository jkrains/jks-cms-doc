# 本地文件集合的导入

支持本地markdown 文件夹的导入， 本地word文件的导入， 选择要文件夹，则可以导入本地文件夹到系统中，并生成RESTfull API， 前端可以通过API 来获取文件夹的目录结构，以及获取文件的内容，进行内容渲染。后端不进行文件内容格式校验。只是按照一定的规则把文件组织起来。

本地文件中如果文件夹包含以`“.” `开头的文件或文件夹将被服务器忽略，前端应该自己过滤掉，以免上传到服务器浪费带宽。



## 文件的上传

**上传PATH**

- `/docs-upload`

**HTTP请求方式**

- POST  
- Content-Type  multipart/form-data  可以使用FormData 进行上传



**FormData中的参数**

| 名称     | 类型     | 说明                                                         |
| -------- | -------- | ------------------------------------------------------------ |
| project  | String   | 项目名称                                                     |
| branch   | String   | 项目分支名称                                                 |
| overview | String   | 描述                                                         |
| tags     | String[] | 标签， 用户自定义，用户可以为这个文件打上标签，方便用户自己处理 |

如果projectName 和branchName 存在，则覆盖，否则服务器将新建文件集合。在上传之前，有必要进行 



次上传，如果不存在，则主动创建

**返回类型**

返回类型与其他API类似，这里不再赘述。



**注意**

-  服务器对http的请求包大小有限制，每一次请求，最大不能超过5M。 超过5M服务器会返回内容过大错误。
- 每个个项目分支的最大限制为5M。

## 文件集内容描述信息

内容描述信息用于描述上传到服务器的文件集， 每个文件集生成一条数据。 

**请求PATH**

- `/docs-infos`

**支持的接口**

- `getList()`,
- `getItemById()`
- `updateItemById()`  
- `deleteItemById()`
- `getTotals()`

**参数实例**

```{json
{
    "_id":"122134124242",
    "cid": "334339f3eedde444",
    "tid": "333343434343434",
    "project": "volley",
    "branch": "v1.0.2",
    "overview": "此版本，描述",
    "tags":["3242424", "3242424242"],
    "files": [
        "权限管理.md",
        "用户注册.md",
        "基础素材/图片.md",
        "基础素材/文集.md"
    ]
}
```

**参数说明**

| 字段     | 是否必须 | 类型     | 说明                     |
| -------- | -------- | -------- | ------------------------ |
| _id      | 是       | String   | 唯一标识，由服务器产生   |
| cid      | 是       | String   | 分类id                   |
| tid      | 是       | String   | 分组id                   |
| project  | 是       | String   | 项目名称                 |
| branch   | 是       | String   | 分支名称，一般携带版本号 |
| overview | 否       | String   | 概述                     |
| tags     | 否       | String[] | 标签，用户设置           |
| files    | 是       | String[] | 所包含的文件路径         |
|          |          |          |                          |

**注意**

当删除相关信息是， 对于的文件一并被删除。



## 元数据获取接口

**请求PATH**

- `/doc-raw/project/branch/权限管理/用户注册.md`

**HTTP请求类型**

- `get`

**说明**

通过http的get请求，按照如上格式，可以找到 元数据,  用户可以对元数据进行前端渲染。 协议格式如上例子

"domain + project + branch + path" 

请求返回实例

```json
{
    scode: 0,
    "msg": "ok",
    "data": {
        "contentType": "md",
        "size": 14600,
        "data": "IyBDcmVkaXRzCgoqKlR5cG9yYSoqIGlzIGRldmVsb"
    }
}
```

**返回实例说明**

| 字段        | 类型   | 说明                                            |
| ----------- | ------ | ----------------------------------------------- |
| contentType | String | 数据格式，一般去后缀名， 如果无后缀，则为binary |
| size        | long   | 数据大小，为实际大小，而非data的长度            |
| data        | String | 数据内容，为原来的数据内容，进行base64编码      |



## 服务器端渲染接口

**请求PATH**

- `/doc-html/project/branch/权限管理/用户注册.md`

**HTTP请求类型**

- `get`

**说明**

通过`http` 的`get` 请求，按照如上格式，对元数据进行前端渲染。 返回的是`HTML`格式，目前支持`md`的格式，如果是图片，则返回的是图片的内容， 浏览器直接可以显示图片。 

建议直接拿到元数据 前端进行渲染。

## 服务端的实现 

服务端可以采用文件的方式存储文件集，也可以使用数据库的方式存储数据集， 由于文件集的大小我们对其进行了限制，在一般的应用场景下，也不可能有大文件存在，后台采用数据库存储文件，方便客户进行整体数据的迁移。如下为数据库的一种存储方式。 本实现采用数据库存储。

**文件存储实例**

```json
{
    "_id": "287654765436754",
    "docsId": "87654675436754675",
    "path": "用户注册.md",
    "contentType": "md",
    "size": 12233343,
    "data": "AAECAwQFBgcICQ==""
}
```



**字段说明**

| 字段        | 是否必须 | 类型   | 说明                                                         |
| ----------- | -------- | ------ | ------------------------------------------------------------ |
| _id         | 否       | String | 由数据库生成，唯一标识。                                     |
| cid         | 是       | String | 分类id。                                                     |
| tid         | 是       | String | 分组id。                                                     |
| docsId      | 是       | String | 文档id， 用于指向文档内容描述信息的id。                      |
| path        | 是       | String | 在文档中所处的路径                                           |
| contentType | 是       | String | 标识内容格式，这里是浏览器识别的                             |
| size        | 是       | long   | 文件长度                                                     |
| data        | 是       | String | 文档内容二进制的base64编码。 所有文档内容， 不区分文本还是二进制，我们全部采用base64编码进行存储。 |



**注意**

对于`url`中包含中文或空格时，要进行编码，否则服务器有可能无法识别。